
<blueprint
        xmlns   = "http://www.osgi.org/xmlns/blueprint/v1.0.0"
        xmlns:cm = "http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0">

    <!-- ******************************************************************* -->
    <!--                                                                     -->
    <!-- ******************************************************************* -->

    <cm:property-placeholder persistent-id="com.github.lburgazzoli.karaf.hazelcast" update-strategy="reload">
        <cm:default-properties>
            <cm:property name = "hz.config"
                         value = "./etc/com.github.lburgazzoli.karaf.hazelcast.xml"/>
        </cm:default-properties>
    </cm:property-placeholder>

    <!-- ******************************************************************* -->
    <!--                                                                     -->
    <!-- ******************************************************************* -->

    <bean id             = "karaf-hazelcast-classloader"
          class          = "com.github.lburgazzoli.osgi.OSGiClassLoader"
          init-method    = "init"
          destroy-method = "destroy"
          scope          = "singleton"/>

    <bean id    = "karaf-hazelcast-cfg"
          class = "com.hazelcast.config.FileSystemXmlConfig"
          scope = "singleton">
        <argument value = "${hz.config}"/>
    </bean>

    <bean id             = "karaf-hazelcast-manager"
          class          = "com.github.lburgazzoli.karaf.hazelcast.HazelcastManager"
          init-method    = "init"
          destroy-method = "destroy"
          scope          = "singleton">
        <argument ref = "blueprintBundleContext"/>
        <argument ref = "karaf-hazelcast-cfg"/>
        <argument ref = "karaf-hazelcast-classloader"/>
    </bean>

    <service ref="karaf-hazelcast-manager">
        <interfaces>
            <value>com.github.lburgazzoli.karaf.hazelcast.IHazelcastManager</value>
        </interfaces>
        <service-properties>
            <entry key   = "osgi.jndi.service.name"
                   value = "karaf-hazelcast-manager"/>
        </service-properties>
    </service>

    <!-- ******************************************************************* -->
    <!-- COMMANDS                                                            -->
    <!-- ******************************************************************* -->

    <command-bundle xmlns="http://karaf.apache.org/xmlns/shell/v1.0.0">
        <command name="hz/member-list">
            <action class="com.github.lburgazzoli.karaf.hazelcast.cmd.MemberList">
                <property name="service" ref="karaf-hazelcast-manager"/>
            </action>
        </command>
        <command name="hz/instance-list">
            <action class="com.github.lburgazzoli.karaf.hazelcast.cmd.InstanceList">
                <property name="service" ref="karaf-hazelcast-manager"/>
            </action>
        </command>
        <command name="hz/instance-info">
            <action class="com.github.lburgazzoli.karaf.hazelcast.cmd.InstanceInfo">
                <property name="service" ref="karaf-hazelcast-manager"/>
            </action>
        </command>
        <command name="hz/instance-browse">
            <action class="com.github.lburgazzoli.karaf.hazelcast.cmd.InstanceBrowse">
                <property name="service" ref="karaf-hazelcast-manager"/>
            </action>
        </command>
    </command-bundle>

</blueprint>
